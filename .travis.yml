sudo: require
services:
  - docker
env:
  global:
    - GIT_SHA=$(git rev-parse HEAD)
before_install:
  - docker build -t schulcloud/edtrio-test -f Dockerfile.dev .
  - docker run -d -p 3000:3000 -t schulcloud/edtrio-test

script:
  - sleep 30 ; curl -s http://localhost:3000/ | grep title
  - docker stop $( docker ps -aq )

after_success:
  - docker build -t schulcloud/edtrio:latest -t schulcloud/edtrio:$GIT_SHA .
  - echo "$DOCKER_PASS" | docker login -u "$DOCKER_ID" --password-stdin
  - docker push schulcloud/edtrio:latest
  - docker push schulcloud/edtrio:$GIT_SHA
# f√ºr OTC
  - echo "$OTC_DOCKER_PASS" | docker login -u "$OTC_DOCKER_ID" --password-stdin
  - docker push 80.158.24.86/schulcloud/edtrio:latest
  - docker push 80.158.24.86/schulcloud/edtrio:$GIT_SHA
   
