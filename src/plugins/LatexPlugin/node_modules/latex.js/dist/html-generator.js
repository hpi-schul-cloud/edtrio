(function(){"use strict";var t,l,d,y,m,f,g,b,_,v,k,e="undefined"!=typeof exports&&exports||this,r=[].slice,x=Array.from||function(t){return r.call(t)};t=require("./symbols"),l=t.ligatures,d=t.diacritics,y=t.symbols,m=require("./macros").LaTeXBase,f=require("katex"),g=require("hypher"),b=require("svg.js"),_=require("he"),v=require("lodash/flattenDeep"),k=require("lodash/compact"),Object.defineProperty(Array.prototype,"top",{enumerable:!1,configurable:!0,get:function(){return this[this.length-1]},set:function(t){this[this.length-1]=t}}),_.decode.options.strict=!0,e.HtmlGenerator=function(){h.displayName="HtmlGenerator";var t,s,e,r,i,o,n,a,p,c,u=h.prototype;function h(t){this._options=Object.assign({documentClass:"article",styles:[],bare:!1,hyphenate:!0},t),this._options.hyphenate&&(this._h=new g(this._options.languagePatterns)),this.reset()}return h.prototype.sp=" ",h.prototype.brsp="​ ",h.prototype.nbsp=_.decode("&nbsp;"),h.prototype.visp=_.decode("&blank;"),h.prototype.zwnj=_.decode("&zwnj;"),h.prototype.shy=_.decode("&shy;"),h.prototype.thinsp=_.decode("&thinsp;"),t=function(t,e){var r;return(r=document.createElement(t)).setAttribute("class",e),r},h.prototype.inlineBlock="span",h.prototype.block="div",h.prototype.titlepage=t(u.block,"titlepage"),h.prototype.title=t(u.block,"title"),h.prototype.author=t(u.block,"author"),h.prototype.date=t(u.block,"date"),h.prototype.abstract=t(u.block,"abstract"),h.prototype.part="part",h.prototype.chapter="h1",h.prototype.section="h2",h.prototype.subsection="h3",h.prototype.subsubsection="h4",h.prototype.paragraph="h5",h.prototype.subparagraph="h6",h.prototype.linebreak="br",h.prototype.par="p",h.prototype.list=t(u.block,"list"),h.prototype.unorderedList=t("ul","list"),h.prototype.orderedList=t("ol","list"),h.prototype.descriptionList=t("dl","list"),h.prototype.listitem="li",h.prototype.term="dt",h.prototype.description="dd",h.prototype.itemlabel=t(u.inlineBlock,"itemlabel"),h.prototype.quote=t(u.block,"list quote"),h.prototype.quotation=t(u.block,"list quotation"),h.prototype.verse=t(u.block,"list verse"),h.prototype.multicols=(a=t(u.block,"multicols"),function(t){return a.setAttribute("style","column-count:"+t),a}),h.prototype.anchor=(p=document.createElement("a"),function(t){return null!=t&&(p.id=t),p}),h.prototype.link=(c=document.createElement("a"),function(t){return t?c.setAttribute("href",t):c.removeAttribute("href"),c}),h.prototype.verb=t("code","tt"),h.prototype.verbatim="pre",h.prototype.picture=t(u.inlineBlock,"picture"),h.prototype.pictureCanvas=t(u.inlineBlock,"picture-canvas"),h.prototype.SVG=b,h.prototype.documentClass=null,h.prototype.documentTitle=null,h.prototype._options=null,h.prototype._macros=null,h.prototype._dom=null,h.prototype._stack=null,h.prototype._groups=null,h.prototype._continue=!1,h.prototype._labels=null,h.prototype._refs=null,h.prototype._counters=null,h.prototype._resets=null,h.prototype._marginpars=null,h.prototype.reset=function(){this.documentClass=this._options.documentClass,this.documentTitle="untitled",this._uid=1,this._dom=document.createDocumentFragment(),this._macros={},this._curArgs=[],this._stack=[{attrs:{},align:null,currentlabel:{id:"",label:document.createTextNode("")},lengths:new Map}],this._groups=[0],this._labels=new Map,this._refs=new Map,this._marginpars=[],this._counters=new Map,this._resets=new Map,this._continue=!1,this.newCounter("enumi"),this.newCounter("enumii"),this.newCounter("enumiii"),this.newCounter("enumiv"),this._macros=new m(this,this._options.CustomMacros)},s=function(t){throw console.error(t),new Error(t)},h.prototype.error=function(t){s(t)},h.prototype.setErrorFn=function(t){s=t},h.prototype.location=function(){s("location function not set!")},h.prototype.character=function(t){return t},h.prototype.textquote=function(t){switch(t){case"`":return this.symbol("textquoteleft");case"'":return this.symbol("textquoteright")}},h.prototype.hyphen=function(){return"tt"===this._stack.top.attrs.fontFamily?"-":_.decode("&hyphen;")},h.prototype.ligature=function(t){return"tt"===this._stack.top.attrs.fontFamily?t:l.get(t)},h.prototype.hasSymbol=function(t){return y.has(t)},h.prototype.symbol=function(t){return this.hasSymbol(t)||s("no such symbol: "+t),y.get(t)},h.prototype.hasDiacritic=function(t){return d.has(t)},h.prototype.diacritic=function(t,e){return e?e+d.get(t)[0]:d.get(t)[1]},h.prototype.controlSymbol=function(t){switch(t){case"/":return this.zwnj;case",":return this.thinsp;case"-":return this.shy;case"@":return"​";default:return this.character(t)}},h.prototype.setTitle=function(t){return this.documentTitle=t.textContent},h.prototype.dom=function(){var t,e,r,o,n,s,i,a,p,c,u;if(this._options.bare)return this._dom;for(t=function(t){var e;return(e=document.createElement("link")).type="text/css",e.rel="stylesheet",e.href=t,e},e=function(t){var e;return(e=document.createElement("script")).src=t,e},r=document.implementation.createHTMLDocument(this.documentTitle),(o=document.createElement("meta")).setAttribute("charset","UTF-8"),r.head.appendChild(o),r.head.appendChild(t("css/katex.css")),r.head.appendChild(t(this.documentClass.css)),n=0,i=(s=this._options.styles).length;n<i;++n)a=s[n],r.head.appendChild(t(a));return window.location?r.head.appendChild(e(new URL("js/base.js",window.location.href).toString())):r.head.appendChild(e("js/base.js")),r.body.appendChild(this.create(this.block,this._dom,"body")),p=Math.round(100*this.length("textwidth").value/this.length("paperwidth").value,1),c=Math.round(100*(this.length("oddsidemargin").value+this.toPx({value:1,unit:"in"}).value)/this.length("paperwidth").value,1),u=Math.max(100-p-c,0),r.body.style.setProperty("--textwidth",p+"%"),r.body.style.setProperty("--marginleftwidth",c+"%"),r.body.style.setProperty("--marginrightwidth",u+"%"),0<u?r.body.style.setProperty("--marginparwidth",1e4*this.length("marginparwidth").value/this.length("paperwidth").value/u+"%"):r.body.style.setProperty("--marginparwidth","0px"),r.body.style.setProperty("--marginparsep",this.length("marginparsep").value+this.length("marginparsep").unit),r.body.style.setProperty("--marginparpush",this.length("marginparpush").value+this.length("marginparpush").unit),r.body.appendChild(this.create(this.block,null,"margin-left")),r.body.appendChild(this.create(this.block,this.create(this.block,this._marginpars,"marginpar"),"margin-right")),r},h.prototype.html=function(){return this.dom().outerHTML},h.prototype.createDocument=function(t){i(this._dom,t)},h.prototype.nextId=function(){return this._uid++},h.prototype.create=function(t,e,r){var o;return null==r&&(r=""),"object"==typeof t?(o=t.cloneNode(!0)).hasAttribute("class")&&(r=o.getAttribute("class")+" "+r):o=document.createElement(t),this.alignment()&&(r+=" "+this.alignment()),this._continue&&this.location().end.offset>this._continue&&(r+=" continue",this.break()),r.trim()&&o.setAttribute("class",r.replace(/\s+/g," ").trim()),i(o,e)},h.prototype.createText=function(t){if(t)return this._wrapWithAttributes(document.createTextNode(this._options.hyphenate?this._h.hyphenateText(t):t))},h.prototype.createVerbatim=function(t){if(t)return document.createTextNode(t)},h.prototype.createFragment=function(){var t,e;if(t=k(v(arguments)),!(0<arguments.length)||t&&t.length)return 1===t.length&&t[0].nodeType?t[0]:(e=document.createDocumentFragment(),i(e,t))},h.prototype.createPicture=function(t,e,r){var o,n;return o=this.create(this.pictureCanvas),i(o,r),e&&o.setAttribute("style","left:"+(-e.x.value+e.x.unit)+";bottom:"+(-e.y.value+e.y.unit)),(n=this.create(this.picture)).appendChild(o),n.setAttribute("style","width:"+(t.x.value+t.x.unit)+";height:"+(t.y.value+t.y.unit)),n},h.prototype.addAttribute=function(t,e){t.hasAttribute("class")&&(e=t.getAttribute("class")+" "+e),t.setAttribute("class",e)},h.prototype.hasAttribute=function(t,e){return t.hasAttribute("class")&&new RegExp("\\b"+e+"\\b").test(t.getAttribute("class"))},h.prototype.createVSpaceSkip=function(t){var e;return(e=document.createElement("span")).setAttribute("class","vspace "+t),e},h.prototype.createVSpaceSkipInline=function(t){var e;return(e=document.createElement("span")).setAttribute("class","vspace-inline "+t),e},h.prototype.createVSpace=function(t){var e;return(e=document.createElement("span")).setAttribute("class","vspace"),e.setAttribute("style","margin-bottom:"+t.value+t.unit),e},h.prototype.createVSpaceInline=function(t){var e;return(e=document.createElement("span")).setAttribute("class","vspace-inline"),e.setAttribute("style","margin-bottom:"+t.value+t.unit),e},h.prototype.createBreakSpace=function(t){var e;return(e=document.createElement("span")).setAttribute("class","breakspace"),e.setAttribute("style","margin-bottom:"+t.value+t.unit),e},h.prototype.createHSpace=function(t){var e;return(e=document.createElement("span")).setAttribute("style","margin-right:"+t.value+t.unit),e},h.prototype.parseMath=function(t,e){var r;return r=document.createDocumentFragment(),f.render(t,r,{displayMode:!!e,throwOnError:!1}),r},h.prototype.hasMacro=function(t){return"function"==typeof this._macros[t]&&(l="===",d={}.toString,r={}.hasOwnProperty,y=function(t,e){return r.call(t,e)},f=!0,!function t(e,r,o){var n,s,i,a,p,c,u,h;if(null==e||null==r)return e===r;if(e.__placeholder__||r.__placeholder__)return!0;if(e===r)return 0!==e||1/e==1/r;if(n=d.call(e),d.call(r)!=n)return!1;switch(n){case"[object String]":return e==String(r);case"[object Number]":return e!=+e?r!=+r:0==e?1/e==1/r:e==+r;case"[object Date]":case"[object Boolean]":return+e==+r;case"[object RegExp]":return e.source==r.source&&e.global==r.global&&e.multiline==r.multiline&&e.ignoreCase==r.ignoreCase}if("object"!=typeof e||"object"!=typeof r)return!1;for(s=o.length;s--;)if(o[s]==e)return!0;if(o.push(e),a=!(i=0),"[object Array]"==n){if(p=e.length,c=r.length,f){switch(l){case"===":a=p===c;break;case"<==":a=p<=c;break;case"<<=":a=p<c}i=p,f=!1}else a=p===c,i=p;if(a)for(;i--&&(a=i in e==i in r&&t(e[i],r[i],o)););}else{if("constructor"in e!="constructor"in r||e.constructor!=r.constructor)return!1;for(u in e)if(y(e,u)&&(i++,!(a=y(r,u)&&t(e[u],r[u],o))))break;if(a){for(u in h=0,r)y(r,u)&&++h;f?a="<<="===l?i<h:"<=="===l?i<=h:i===h:(f=!1,a=i===h)}}return o.pop(),a}(t,"constructor",[]))&&(this._macros.hasOwnProperty(t)||m.prototype.hasOwnProperty(t));var l,d,r,y,f},h.prototype.isHmode=function(t){var e;return"H"===(null!=(e=m.args[t])?e[0]:void 0)||!m.args[t]},h.prototype.isVmode=function(t){var e;return"V"===(null!=(e=m.args[t])?e[0]:void 0)},h.prototype.isHVmode=function(t){var e;return"HV"===(null!=(e=m.args[t])?e[0]:void 0)},h.prototype.isPreamble=function(t){var e;return"P"===(null!=(e=m.args[t])?e[0]:void 0)},h.prototype.macro=function(t,e){var r,o=this;return y.has(t)?[this.createText(y.get(t))]:null!=(r=this._macros[t].apply(this._macros,e))?r.filter(function(t){return null!=t}).map(function(t){return null==t.nodeType?o.createText(t):t}):void 0},h.prototype.beginArgs=function(t){var e;this._curArgs.push((e=m.args[t])?{name:t,args:e.slice(1),parsed:[]}:{args:[],parsed:[]})},h.prototype.nextArg=function(t){if(this._curArgs.top.args[0]===t)return this._curArgs.top.args.shift(),!0},h.prototype.argError=function(t){return s("macro \\"+this._curArgs.top.name+": "+t)},h.prototype.addParsedArg=function(t){this._curArgs.top.parsed.push(t)},h.prototype.parsedArgs=function(){return this._curArgs.top.parsed},h.prototype.preExecMacro=function(){this.macro(this._curArgs.top.name,this.parsedArgs())},h.prototype.endArgs=function(){var t;return 0===(t=this._curArgs.pop()).args.length||s("grammar error: arguments for "+t.name+" have not been parsed: "+t.args),t.parsed},h.prototype.begin=function(t){this.hasMacro(t)||s("unknown environment: "+t),this.startBalanced(),this.enterGroup(),this.beginArgs(t)},h.prototype.end=function(t,e){var r;return t!==e&&s("environment '"+t+"' is missing its end, found '"+e+"' instead"),this.hasMacro("end"+t)&&(r=this.macro("end"+t)),this.exitGroup(),this.isBalanced()||s(t+": groups need to be balanced in environments!"),this.endBalanced(),r},h.prototype.enterGroup=function(){this._stack.push({attrs:Object.assign({},this._stack.top.attrs),align:null,currentlabel:Object.assign({},this._stack.top.currentlabel),lengths:new Map(this._stack.top.lengths)}),++this._groups.top},h.prototype.exitGroup=function(){0<=--this._groups.top||s("there is no group to end here"),this._stack.pop()},h.prototype.startBalanced=function(){this._groups.push(0)},h.prototype.endBalanced=function(){return this._groups.pop(),this._groups.length},h.prototype.isBalanced=function(){return 0===this._groups.top},h.prototype.continue=function(){this._continue=this.location().end.offset},h.prototype.break=function(){this.location().end.offset>this._continue&&(this._continue=!1)},h.prototype.setAlignment=function(t){this._stack.top.align=t},h.prototype.alignment=function(){return this._stack.top.align},h.prototype.setFontFamily=function(t){this._stack.top.attrs.fontFamily=t},h.prototype.setFontWeight=function(t){this._stack.top.attrs.fontWeight=t},h.prototype.setFontShape=function(t){"em"===t&&(t="it"===this._stack.top.attrs.fontShape?"up":"it"),this._stack.top.attrs.fontShape=t},h.prototype.setFontSize=function(t){this._stack.top.attrs.fontSize=t},h.prototype.setTextDecoration=function(t){this._stack.top.attrs.textDecoration=t},h.prototype._inlineAttributes=function(){var t;return[(t=this._stack.top.attrs).fontFamily,t.fontWeight,t.fontShape,t.fontSize,t.textDecoration].join(" ").replace(/\s+/g," ").trim()},h.prototype.startsection=function(t,e,r,o,n){var s,i,a;if(o!=n||null!=n)return!r&&this.counter("secnumdepth")>=e?("chapter"===t?(s=this.create(this.block,this.macro("chaptername").concat(this.createText(this.symbol("space")),this.macro("the"+t))),i=this.create(this[t],[s,n])):i=this.create(this[t],this.macro("the"+t).concat(this.createText(this.symbol("quad")),n)),null!=(a=this._stack.top.currentlabel.id)&&(i.id=a)):i=this.create(this[t],n),i;!r&&this.counter("secnumdepth")>=e&&(this.stepCounter(t),this.refCounter(t,"sec-"+this.nextId()))},h.prototype.startlist=function(){return this.stepCounter("@listdepth"),6<this.counter("@listdepth")&&s("too deeply nested"),!0},h.prototype.endlist=function(){this.setCounter("@listdepth",this.counter("@listdepth")-1),this.continue()},h.prototype.newLength=function(t){this.hasLength(t)&&s("length "+t+" already defined!"),this._stack.top.lengths.set(t,{value:0,unit:"px"})},h.prototype.hasLength=function(t){return this._stack.top.lengths.has(t)},h.prototype.setLength=function(t,e){this.hasLength(t)||s("no such length: "+t),this._stack.top.lengths.set(t,this.toPx(e))},h.prototype.length=function(t){return this.hasLength(t)||s("no such length: "+t),this._stack.top.lengths.get(t)},h.prototype.theLength=function(t){var e;return(e=this.create(this.inlineBlock,void 0,"the")).setAttribute("display-var",t),e},new Map([["sp",15259e-9],["dd",1.07],["mm",2.84527559],["pc",12],["cc",12.84],["cm",28.4527559],["in",72.27]]),e=new Map([["sp",20345e-9],["pt",1.333333],["dd",1.420875],["mm",3.779528],["pc",16],["cc",17.0505],["cm",37.79528],["in",96]]),h.prototype.toPx=function(t){return e.has(t.unit)?{value:t.value*e.get(t.unit),unit:"px"}:t},h.prototype.newCounter=function(t,e){this.hasCounter(t)&&s("counter "+t+" already defined!"),this._counters.set(t,0),this._resets.set(t,[]),e&&this.addToReset(t,e),this.hasMacro("the"+t)&&s("macro \\the"+t+" already defined!"),this._macros["the"+t]=function(){return[this.g.arabic(this.g.counter(t))]}},h.prototype.hasCounter=function(t){return this._counters.has(t)},h.prototype.setCounter=function(t,e){this.hasCounter(t)||s("no such counter: "+t),this._counters.set(t,e)},h.prototype.stepCounter=function(t){this.setCounter(t,this.counter(t)+1),this.clearCounter(t)},h.prototype.counter=function(t){return this.hasCounter(t)||s("no such counter: "+t),this._counters.get(t)},h.prototype.refCounter=function(t,e){var r;return e||(e=t+"-"+this.nextId(),r=this.create(this.anchor(e))),this._stack.top.currentlabel={id:e,label:this.createFragment(x(this.hasMacro("p@"+t)?this.macro("p@"+t):[]).concat(x(this.macro("the"+t))))},r},h.prototype.addToReset=function(t,e){this.hasCounter(e)||s("no such counter: "+e),this.hasCounter(t)||s("no such counter: "+t),this._resets.get(e).push(t)},h.prototype.clearCounter=function(t){var e,r,o,n;for(e=0,o=(r=this._resets.get(t)).length;e<o;++e)n=r[e],this.clearCounter(n),this.setCounter(n,0)},h.prototype.alph=function(t){return String.fromCharCode(96+t)},h.prototype.Alph=function(t){return String.fromCharCode(64+t)},h.prototype.arabic=function(t){return String(t)},h.prototype.roman=function(t){return r(t,[["m",1e3],["cm",900],["d",500],["cd",400],["c",100],["xc",90],["l",50],["xl",40],["x",10],["ix",9],["v",5],["iv",4],["i",1]])},h.prototype.Roman=function(t){return r(t,[["M",1e3],["CM",900],["D",500],["CD",400],["C",100],["XC",90],["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]])},r=function(t,e){var r,o,n,s;for(r="",o=0,n=e.length;o<n;++o)for(s=e[o];t>=s[1];)r+=s[0],t-=s[1];return r},h.prototype.fnsymbol=function(t){switch(t){case 1:return this.symbol("textasteriskcentered");case 2:return this.symbol("textdagger");case 3:return this.symbol("textdaggerdbl");case 4:return this.symbol("textsection");case 5:return this.symbol("textparagraph");case 6:return this.symbol("textbardbl");case 7:return this.symbol("textasteriskcentered")+this.symbol("textasteriskcentered");case 8:return this.symbol("textdagger")+this.symbol("textdagger");case 9:return this.symbol("textdaggerdbl")+this.symbol("textdaggerdbl");default:return s("fnsymbol value must be between 1 and 9")}},h.prototype.setLabel=function(t){var e,r,o,n;if(this._labels.has(t)&&s("label "+t+" already defined!"),this._stack.top.currentlabel.id||console.warn("warning: no \\@currentlabel available for label "+t+"!"),this._labels.set(t,this._stack.top.currentlabel),this._refs.has(t)){for(e=0,o=(r=this._refs.get(t)).length;e<o;++e){for(n=r[e];n.firstChild;)n.removeChild(n.firstChild);n.appendChild(this._stack.top.currentlabel.label.cloneNode(!0)),n.setAttribute("href","#"+this._stack.top.currentlabel.id)}this._refs.delete(t)}},h.prototype.ref=function(t){var e,r;return(e=this._labels.get(t))?this.create(this.link("#"+e.id),e.label.cloneNode(!0)):(r=this.create(this.link("#"),this.createText("??")),this._refs.has(t)?this._refs.get(t).push(r):this._refs.set(t,[r]),r)},h.prototype.logUndefinedRefs=function(){var t,e;if(0!==this._refs.size){for(t=this._refs.keys();!(e=t.next()).done;)console.warn("warning: reference '"+e.value+"' undefined");console.warn("There were undefined references.")}},h.prototype.marginpar=function(t){var e,r,o;return e=this.nextId(),(r=this.create(this.block,[this.create(this.inlineBlock,null,"mpbaseline"),t])).id=e,this._marginpars.push(r),(o=this.create(this.inlineBlock,null,"mpbaseline")).id="marginref-"+e,o},i=function(t,e){var r,o,n;if(e)if(Array.isArray(e))for(r=0,o=e.length;r<=o;++r)null!=e[n=r]&&t.appendChild(e[n]);else t.appendChild(e);return t},h.prototype._wrapWithAttributes=function(t,e){var r;return e||(e=this._inlineAttributes()),e?((r=document.createElement("span")).setAttribute("class",e),r.appendChild(t),r):t},o=function(t,e){var r;if(t.hasChildNodes())for(r=t.firstChild;r;r=r.nextSibling)o(r,e);e.call(t)},n=function(t){t&&(void 0!==t.nodeName?console.log(t.nodeName+":",t.textContent):console.log("not a node:",t))},function(t){var e,r,o;for(e=0,r=t.length;e<r;++e)o=t[e],n(o)},function(){this.nodeValue&&console.log(this.nodeValue)},h}()}).call(this);